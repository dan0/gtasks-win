<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="GTasks.UI.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:GTasks.UI.Converters"
    NavigationCacheMode="Enabled">

    <Page.Resources>
        <converters:BoolToStrikethroughConverter x:Key="BoolToStrikethrough" />
        <converters:StringToVisibilityConverter x:Key="StringToVisibility" />
        <converters:DateToStringConverter x:Key="DateToString" />
    </Page.Resources>

    <Grid>
        <!-- Login View -->
        <Grid x:Name="LoginView" Visibility="Visible">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#1a1a2e" Offset="0.0" />
                    <GradientStop Color="#16213e" Offset="1.0" />
                </LinearGradientBrush>
            </Grid.Background>

            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="32" MaxWidth="400">
                <!-- Logo/Title -->
                <StackPanel Spacing="8" HorizontalAlignment="Center">
                    <FontIcon Glyph="&#xE73E;" FontSize="64" Foreground="#4FC3F7" />
                    <TextBlock Text="GTasks"
                               Style="{StaticResource TitleLargeTextBlockStyle}"
                               Foreground="White"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="A modern Google Tasks client for Windows"
                               Style="{StaticResource BodyTextBlockStyle}"
                               Foreground="#888"
                               HorizontalAlignment="Center" />
                </StackPanel>

                <!-- Features list -->
                <StackPanel Spacing="12">
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <FontIcon Glyph="&#xE8FB;" FontSize="20" Foreground="#4FC3F7" />
                        <TextBlock Text="Keyboard-first design with vim-style navigation" Foreground="#CCC" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <FontIcon Glyph="&#xE895;" FontSize="20" Foreground="#4FC3F7" />
                        <TextBlock Text="Offline support with background sync" Foreground="#CCC" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <FontIcon Glyph="&#xE771;" FontSize="20" Foreground="#4FC3F7" />
                        <TextBlock Text="Native Windows 11 look with Mica" Foreground="#CCC" />
                    </StackPanel>
                </StackPanel>

                <!-- Login Button -->
                <Button x:Name="LoginButton"
                        Click="LoginButton_Click"
                        HorizontalAlignment="Center"
                        Padding="24,12"
                        CornerRadius="8">
                    <Button.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                            <GradientStop Color="#4285F4" Offset="0.0" />
                            <GradientStop Color="#34A853" Offset="0.33" />
                            <GradientStop Color="#FBBC05" Offset="0.66" />
                            <GradientStop Color="#EA4335" Offset="1.0" />
                        </LinearGradientBrush>
                    </Button.Background>
                    <StackPanel Orientation="Horizontal" Spacing="12">
                        <FontIcon Glyph="&#xE8FA;" FontSize="20" Foreground="White" />
                        <TextBlock Text="Connect Google Account"
                                   Foreground="White"
                                   FontWeight="SemiBold" />
                    </StackPanel>
                </Button>

                <!-- Status message -->
                <TextBlock x:Name="StatusText"
                           Text=""
                           Foreground="#F44336"
                           HorizontalAlignment="Center"
                           TextWrapping="Wrap" />

                <!-- Loading indicator -->
                <ProgressRing x:Name="LoginProgress"
                              IsActive="False"
                              Width="32" Height="32" />
            </StackPanel>
        </Grid>

        <!-- Main App View -->
        <Grid x:Name="MainAppView" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="48" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Grid.ColumnSpan="2" Padding="16,0">
                <TextBlock Text="GTasks"
                           Style="{StaticResource TitleTextBlockStyle}"
                           VerticalAlignment="Center" />
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Spacing="8">
                    <ProgressRing x:Name="SyncProgress"
                                  IsActive="False"
                                  Width="20" Height="20" />
                    <Button x:Name="SyncButton" Click="SyncButton_Click" ToolTipService.ToolTip="Sync now">
                        <FontIcon Glyph="&#xE895;" FontSize="16" />
                    </Button>
                    <Button x:Name="SettingsButton" ToolTipService.ToolTip="Settings">
                        <Button.Flyout>
                            <MenuFlyout>
                                <MenuFlyoutItem Text="Switch Account" Click="SwitchAccount_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xE748;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                                <MenuFlyoutSeparator />
                                <MenuFlyoutItem Text="Sign Out" Click="LogoutMenuItem_Click">
                                    <MenuFlyoutItem.Icon>
                                        <FontIcon Glyph="&#xF3B1;" />
                                    </MenuFlyoutItem.Icon>
                                </MenuFlyoutItem>
                            </MenuFlyout>
                        </Button.Flyout>
                        <FontIcon Glyph="&#xE713;" FontSize="16" />
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Sidebar -->
            <Grid Grid.Row="1" Grid.Column="0"
                  Background="{ThemeResource LayerFillColorDefaultBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Smart Filters -->
                <StackPanel Grid.Row="0" Margin="16,12,16,4">
                    <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,0,0,8">
                        <Button x:Name="TodayFilter" Click="FilterButton_Click" Tag="Today"
                                Background="Transparent" Padding="6,4" CornerRadius="4"
                                ToolTipService.ToolTip="Show tasks due today">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8BF;" FontSize="12" Foreground="#4FC3F7" />
                                <TextBlock Text="Today" FontSize="12" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="TomorrowFilter" Click="FilterButton_Click" Tag="Tomorrow"
                                Background="Transparent" Padding="6,4" CornerRadius="4"
                                ToolTipService.ToolTip="Show tasks due tomorrow">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE787;" FontSize="12" Foreground="#81C784" />
                                <TextBlock Text="Tomorrow" FontSize="12" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="OverdueFilter" Click="FilterButton_Click" Tag="Overdue"
                                Background="Transparent" Padding="6,4" CornerRadius="4"
                                ToolTipService.ToolTip="Show overdue tasks">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE783;" FontSize="12" Foreground="#E57373" />
                                <TextBlock Text="Overdue" FontSize="12" />
                            </StackPanel>
                        </Button>
                        <Button x:Name="ClearFilter" Click="ClearFilterButton_Click"
                                Background="Transparent" Padding="6,4" CornerRadius="4"
                                ToolTipService.ToolTip="Clear filters">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE711;" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                <TextBlock Text="Clear" FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </StackPanel>

                <StackPanel Grid.Row="1" Margin="16,8,16,0">
                    <TextBlock Text="Task Lists"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Margin="0,0,0,12" />
                    <ListView x:Name="TaskListsView"
                              SelectionMode="Single"
                              SelectionChanged="TaskListsView_SelectionChanged">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="{Binding Title}" VerticalAlignment="Center" />
                                    <Border Grid.Column="1"
                                            Background="{ThemeResource AccentFillColorDefaultBrush}"
                                            CornerRadius="10" Padding="8,2"
                                            Visibility="{Binding PendingCount}">
                                        <TextBlock Text="{Binding PendingCount}"
                                                   FontSize="12" Foreground="White" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </StackPanel>

                <Button Grid.Row="2"
                        Content="+ New List"
                        HorizontalAlignment="Stretch"
                        Margin="16,8"
                        Click="NewListButton_Click" />

                <!-- User info -->
                <Border Grid.Row="3"
                        Background="{ThemeResource SubtleFillColorSecondaryBrush}"
                        Padding="16,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <TextBlock x:Name="UserEmailText"
                                       Text="user@gmail.com"
                                       Style="{StaticResource CaptionTextBlockStyle}" />
                            <TextBlock x:Name="SyncStatusText"
                                       Text="Synced"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                        </StackPanel>
                        <Button Grid.Column="1"
                                Click="LogoutButton_Click"
                                ToolTipService.ToolTip="Sign out">
                            <FontIcon Glyph="&#xF3B1;" FontSize="14" />
                        </Button>
                    </Grid>
                </Border>
            </Grid>

            <!-- Main Content -->
            <Grid Grid.Row="1" Grid.Column="1" Padding="24,16">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Quick Add -->
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="QuickAddBox"
                             PlaceholderText="Add a task... (Enter to save, 'today'/'tomorrow' for due date)"
                             KeyDown="QuickAddBox_KeyDown"
                             Padding="12"
                             CornerRadius="8,0,0,8" />
                    <Button Grid.Column="1"
                            x:Name="AddTaskButton"
                            Click="AddTaskButton_Click"
                            CornerRadius="0,8,8,0"
                            Padding="16,12"
                            Background="{ThemeResource AccentFillColorDefaultBrush}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE710;" FontSize="14" Foreground="White" />
                            <TextBlock Text="Add" Foreground="White" FontWeight="SemiBold" />
                        </StackPanel>
                    </Button>
                </Grid>

                <!-- Task List -->
                <ListView Grid.Row="1"
                          x:Name="TasksView"
                          SelectionMode="Single"
                          SelectionChanged="TasksView_SelectionChanged">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Padding="8,12">
                                <Grid.ContextFlyout>
                                    <MenuFlyout>
                                        <MenuFlyoutItem Text="Delete" Icon="Delete" Click="DeleteTask_Click" />
                                    </MenuFlyout>
                                </Grid.ContextFlyout>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <CheckBox IsChecked="{Binding IsCompleted, Mode=TwoWay}"
                                          Click="TaskCheckBox_Click"
                                          VerticalAlignment="Center" />
                                <StackPanel Grid.Column="1" Margin="8,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Title}"
                                               TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToStrikethrough}}" />
                                    <TextBlock Text="{Binding Notes}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                               MaxLines="1"
                                               TextTrimming="CharacterEllipsis"
                                               Visibility="{Binding Notes, Converter={StaticResource StringToVisibility}}" />
                                </StackPanel>
                                <TextBlock Grid.Column="2"
                                           Text="{Binding Due, Converter={StaticResource DateToString}}"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           VerticalAlignment="Center" />
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- Empty State -->
                <StackPanel Grid.Row="1"
                            x:Name="EmptyState"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Visibility="Collapsed">
                    <FontIcon Glyph="&#xE73E;" FontSize="48"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    <TextBlock Text="No tasks yet"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,8" />
                    <TextBlock Text="Press N to add your first task"
                               Style="{StaticResource CaptionTextBlockStyle}"
                               HorizontalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Page>
